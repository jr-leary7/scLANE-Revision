---
title: "Figure 2"
subtitle: "Bacher Group"
date: today
date-format: long
author:
  - name: Jack R. Leary
    orcid: 0009-0004-8821-3269
    email: j.leary@ufl.edu
    corresponding: true
    affiliation: 
      - name: University of Florida
        department: Department of Biostatistics
        city: Gainesville
        state: FL
        country: US
format:
  html: 
    theme: journal
    highlight-style: tango
    toc: true
    toc-depth: 2
    toc-location: left
    code-copy: hover
    code-tools: true
    code-fold: show
    embed-resources: true
    number-sections: true
    fig-width: 6
    fig-height: 4
    fig-dpi: 320
    fig-align: center
    fig-cap-location: bottom
    tbl-cap-location: bottom
editor: source
---

```{r setup}
#| include: false
knitr::opts_chunk$set(comment = NA)
set.seed(312)  # lucky seed
```

# Libraries {#sec-libs}

```{r}
#| message: false
#| warning: false
library(dplyr)      # data manipulation
library(scLANE)     # trajectory DE testing
library(ggplot2)    # pretty plots
library(patchwork)  # plot alignment
```

# Data {#sec-data}

```{r}
metric_table_master <- qs::qread("../../data/simulation/metric_table_master")
```

# Visualization tools {#sec-viz-tools}

```{r}
palette_models <- c("#DC0000FF", "#00A1D5FF", "#D37295FF", "#349B58FF")
names(palette_models) <- c("scLANE - GLM", "tradeSeq", "scLANE - GEE", "scLANE - GLMM")
```

# Supplementary Figure 1 {#sec-fig1}

## A

```{r}
#| fig-width: 2.4
#| fig-height: 2.5
S_Fig_1A <- filter(metric_table_master, 
                   MODEL_TYPE %in% c("scLANE - GLM", "tradeSeq")) %>% 
            mutate(N_CELLS = round(N_CELLS, -1), 
                   N_CELLS = as.factor(N_CELLS)) %>% 
            ggplot(aes(x = N_CELLS, y = F_MEASURE, color = MODEL_TYPE)) + 
            geom_boxplot(linewidth = 0.75, 
                         fatten = 0.75, 
                         alpha = 0.25, 
                         outlier.shape = NA, 
                         position = position_dodge(width = 1), 
                         key_glyph = "path") + 
            geom_point(size = 1, 
                       alpha = 1, 
                       stroke = 0, 
                       show.legend = FALSE, 
                       position = position_jitterdodge(dodge.width = 1, seed = 312)) + 
            scale_y_continuous(labels = scales::label_percent(accuracy = 1), limits = c(NA, 1)) + 
            scale_color_manual(values = palette_models) + 
            labs(x = "Cells", y = "F-measure") + 
            theme_scLANE(base.size = 9) + 
            theme(legend.title = element_blank(),
                  legend.position = "top", 
                  legend.direction = "horizontal",
                  legend.spacing.x = unit(0.02, "in"),
                  legend.text = element_text(margin = margin(r = 0.1, unit = "in")), 
                  legend.margin = margin(t = -0.02, b = -0.02, unit = "in")) + 
            guides(color = guide_legend(override.aes = list(linewidth = 2, alpha = 1)), 
                   fill = NULL)
S_Fig_1A
```

```{r}
ggsave("Suppl_Figure_1A.png",
       plot = S_Fig_1A, 
       device = "png", 
       path = "../png/",
       width = 2.4, 
       height = 2.5, 
       units = "in", 
       dpi = 300)
```

## B

```{r}
#| fig-width: 2.4
#| fig-height: 2.5
S_Fig_1B <- filter(metric_table_master, 
                   MODEL_TYPE %in% c("scLANE - GLM", "tradeSeq")) %>% 
            mutate(N_CELLS = round(N_CELLS, -1), 
                   N_CELLS = as.factor(N_CELLS)) %>% 
            ggplot(aes(x = N_CELLS, y = SENSITIVITY, color = MODEL_TYPE)) + 
            geom_boxplot(linewidth = 0.75, 
                         fatten = 0.75, 
                         alpha = 0.25, 
                         outlier.shape = NA, 
                         position = position_dodge(width = 1), 
                         key_glyph = "path") + 
            geom_point(size = 1, 
                       alpha = 1, 
                       stroke = 0, 
                       show.legend = FALSE, 
                       position = position_jitterdodge(dodge.width = 1, seed = 312)) + 
            scale_y_continuous(labels = scales::label_percent(accuracy = 1), limits = c(NA, 1)) + 
            scale_color_manual(values = palette_models) + 
            labs(x = "Cells", y = "Sensitivity") + 
            theme_scLANE(base.size = 9) + 
            theme(legend.position = "none")
S_Fig_1B
```

```{r}
ggsave("Suppl_Figure_1B.png",
       plot = S_Fig_1B, 
       device = "png", 
       path = "../png/",
       width = 2.4, 
       height = 2.5, 
       units = "in", 
       dpi = 300)
```

## C

```{r}
#| fig-width: 2.4
#| fig-height: 2.5
S_Fig_1C <- filter(metric_table_master, 
                   MODEL_TYPE %in% c("scLANE - GLM", "tradeSeq")) %>% 
            mutate(N_CELLS = round(N_CELLS, -1), 
                   N_CELLS = as.factor(N_CELLS)) %>% 
            ggplot(aes(x = N_CELLS, y = ROC_AUC, color = MODEL_TYPE)) + 
            geom_boxplot(linewidth = 0.75, 
                         fatten = 0.75, 
                         alpha = 0.25, 
                         outlier.shape = NA, 
                         position = position_dodge(width = 1), 
                         key_glyph = "path") + 
            geom_point(size = 1, 
                       alpha = 1, 
                       stroke = 0, 
                       show.legend = FALSE, 
                       position = position_jitterdodge(dodge.width = 1, seed = 312)) + 
            scale_y_continuous(labels = scales::label_percent(accuracy = 1), limits = c(NA, 1)) + 
            scale_color_manual(values = palette_models) + 
            labs(x = "Cells", y = "ROC-AUC") + 
            theme_scLANE(base.size = 9) + 
            theme(legend.position = "none")
S_Fig_1C
```

```{r}
ggsave("Suppl_Figure_1C.png",
       plot = S_Fig_1C, 
       device = "png", 
       path = "../png/",
       width = 2.4, 
       height = 2.5, 
       units = "in", 
       dpi = 300)
```

## D

```{r}
#| fig-width: 7.3
#| fig-height: 3
S_Fig_1D <- filter(metric_table_master, 
                   MODEL_TYPE %in% c("scLANE - GEE", "scLANE - GLMM")) %>% 
            ggplot(aes(x = SIM_REFERENCE, y = BAL_ACCURACY, color = MODEL_TYPE)) + 
            facet_wrap(~MODEL_TYPE, ncol = 2) + 
            geom_boxplot(linewidth = 0.75, 
                         fatten = 0.75, 
                         alpha = 0.25, 
                         outlier.shape = NA, 
                         position = position_dodge(width = 1), 
                         key_glyph = "path") + 
            geom_point(size = 1, 
                       alpha = 1, 
                       stroke = 0, 
                       show.legend = FALSE, 
                       position = position_jitterdodge(dodge.width = 1, seed = 312)) + 
            scale_y_continuous(labels = scales::label_percent(accuracy = 1), limits = c(NA, 1)) + 
            scale_color_manual(values = palette_models) + 
            labs(x = "Reference Dataset", y = "Balanced Accuracy") + 
            theme_scLANE(base.size = 9) + 
            theme(legend.title = element_blank(),
                  legend.position = "top", 
                  legend.direction = "horizontal",
                  legend.spacing.x = unit(0.02, "in"),
                  legend.text = element_text(margin = margin(r = 0.1, unit = "in")), 
                  legend.margin = margin(t = -0.02, b = -0.02, unit = "in")) + 
            guides(color = guide_legend(override.aes = list(linewidth = 2, alpha = 1)), 
                   fill = NULL)
S_Fig_1D
```

```{r}
ggsave("Suppl_Figure_1D.png",
       plot = S_Fig_1D, 
       device = "png", 
       path = "../png/",
       width = 7.3, 
       height = 2.5, 
       units = "in", 
       dpi = 300)
```

## E

## F

# Session info {#sec-SI}

```{r}
sessioninfo::session_info()
```
